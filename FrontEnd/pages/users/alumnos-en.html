<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="title-text">Dashboard Estudiante - Legado TP</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- HEADER -->
    <header class="dashboard-header">
      <div class="logo-container">
        <img
          src="../assets/img/logo.png"
          alt="Logo institucional"
          class="logo"
        />
        <span class="brand">ãƒ¬ã‚¬ãƒ‰-TP</span>
      </div>

      <nav class="dashboard-nav" aria-label="Main Navigation">
        <a href="#inicio" id="nav-inicio">Inicio</a>
        <a href="{{ url_for('postulaciones.ofertas') }}" id="nav-ofertas">Ofertas</a>
        <a href="{{ url_for('empresas.listar') }}" id="nav-empresas">Empresas</a>
        <a href="{{ url_for('usuarios.perfil') }}" id="nav-perfil">Perfil</a>
      </nav>

      {% if nombre %}
      <div class="user-info">
        <span id="welcome-text">Bienvenido, {{ nombre }} {{ apellido }}</span>
        <form method="post" action="{{ url_for('auth.logout') }}">
          <button type="submit" class="btn-logout" id="btn-logout">
            Cerrar SesiÃ³n
          </button>
        </form>
      </div>
      {% endif %}

      <!-- SELECTOR DE IDIOMA -->
      <div class="header-language">
        <label for="language-select">Idioma:</label>
        <select
          id="language-select"
          onchange="cambiarIdiomaDashboard(this.value)"
        >
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="en">ðŸ‡ºðŸ‡¸ English</option>
        </select>
      </div>
    </header>

    <!-- MAIN DASHBOARD -->
    <main class="dashboard-main">
      <!-- PERFIL -->
      <section class="dashboard-card profile-card" id="inicio">
        <h2 id="perfil-title">Perfil</h2>
        <p><strong id="nombre-text">Nombre:</strong> {{ nombre }}</p>
        <p><strong id="rut-text">RUT:</strong> {{ rut }}</p>
        <p>
          <strong id="especialidad-text">Especialidad:</strong> {{ especialidad
          }}
        </p>
        <p>
          <strong id="profesor-text">Profesor a cargo:</strong> {{ profesor }}
        </p>
        <a
          href="{{ url_for('usuarios.editar_perfil') }}"
          class="btn-primary"
          id="btn-editar-perfil"
          >Editar Perfil</a
        >
      </section>

      <!-- OFERTAS -->
      <section class="dashboard-card" aria-labelledby="ofertas-title">
        <h2 id="ofertas-title">Ofertas Laborales</h2>
        {% if ofertas %} {% for oferta in ofertas %}
        <article class="oferta-item">
          <p><strong>{{ oferta.titulo }}</strong> - {{ oferta.empresa }}</p>
          <a
            href="{{ url_for('postulaciones.postular', id=oferta.id) }}"
            class="btn-secondary2 btn-postular"
            >Postular</a
          >
        </article>
        {% endfor %} {% else %}
        <p id="no-ofertas">No hay ofertas disponibles.</p>
        {% endif %}
      </section>

      <!-- HISTORIAL POSTULACIONES -->
      <section class="dashboard-card" aria-labelledby="historial-title">
        <h2 id="historial-title">Historial de Postulaciones</h2>
        {% if postulaciones %} {% for post in postulaciones %}
        <article class="post-item">
          <p>{{ post.oferta }} - Estado: {{ post.estado }}</p>
        </article>
        {% endfor %} {% else %}
        <p id="no-postulaciones">No has postulado a ninguna oferta aÃºn.</p>
        {% endif %}
      </section>

      <!-- EMPRESAS -->
      <section class="dashboard-card" aria-labelledby="empresas-title">
        <h2 id="empresas-title">Empresas</h2>
        {% if empresas %} {% for empresa in empresas %}
        <article class="empresa-item">
          <p>{{ empresa.nombre }}</p>
          <a
            href="{{ url_for('empresas.ver_empresa', id=empresa.id) }}"
            class="btn-secondary2 btn-ver-empresa"
            >Ver Empresa</a
          >
        </article>
        {% endfor %} {% else %}
        <p id="no-empresas">No hay empresas disponibles.</p>
        {% endif %}
      </section>
    </main>

    <!-- NAV MOBILE -->
    <nav class="mobile-nav" role="navigation" aria-label="Mobile Navigation">
      <a href="#inicio" id="mobile-inicio"
        ><i class="fas fa-home"></i><span>Inicio</span></a
      >
      <a href="{{ url_for('postulaciones.ofertas') }}" id="mobile-ofertas"
        ><i class="fas fa-briefcase"></i><span>Ofertas</span></a
      >
      <a href="{{ url_for('empresas.listar') }}" id="mobile-empresas"
        ><i class="fas fa-building"></i><span>Empresas</span></a
      >
      <a href="{{ url_for('usuarios.perfil') }}" id="mobile-perfil"
        ><i class="fas fa-user"></i><span>Perfil</span></a
      >
    </nav>

    <!-- SCRIPT DE IDIOMAS -->
    <script>
      const traduccionesDashboard = {
        es: {
          "title-text": "Dashboard Estudiante - Legado TP",
          "nav-inicio": "Inicio",
          "nav-ofertas": "Ofertas",
          "nav-empresas": "Empresas",
          "nav-perfil": "Perfil",
          "welcome-text": "Bienvenido, {{ nombre }} {{ apellido }}",
          "perfil-title": "Perfil",
          "nombre-text": "Nombre:",
          "rut-text": "RUT:",
          "especialidad-text": "Especialidad:",
          "profesor-text": "Profesor a cargo:",
          "btn-editar-perfil": "Editar Perfil",
          "ofertas-title": "Ofertas Laborales",
          "btn-postular": "Postular",
          "no-ofertas": "No hay ofertas disponibles.",
          "historial-title": "Historial de Postulaciones",
          "no-postulaciones": "No has postulado a ninguna oferta aÃºn.",
          "empresas-title": "Empresas",
          "btn-ver-empresa": "Ver Empresa",
          "no-empresas": "No hay empresas disponibles.",
          "mobile-inicio": "Inicio",
          "mobile-ofertas": "Ofertas",
          "mobile-empresas": "Empresas",
          "mobile-perfil": "Perfil",
        },
        en: {
          "title-text": "Student Dashboard - Legado TP",
          "nav-inicio": "Start",
          "nav-ofertas": "Offers",
          "nav-empresas": "Companies",
          "nav-perfil": "Profile",
          "welcome-text": "Welcome, {{ nombre }} {{ apellido }}",
          "perfil-title": "Profile",
          "nombre-text": "Name:",
          "rut-text": "RUT:",
          "especialidad-text": "Specialty:",
          "profesor-text": "Assigned Teacher:",
          "btn-editar-perfil": "Edit Profile",
          "ofertas-title": "Job Offers",
          "btn-postular": "Apply",
          "no-ofertas": "No job offers available.",
          "historial-title": "Application History",
          "no-postulaciones": "You haven't applied to any offers yet.",
          "empresas-title": "Companies",
          "btn-ver-empresa": "View Company",
          "no-empresas": "No companies available.",
          "mobile-inicio": "Start",
          "mobile-ofertas": "Offers",
          "mobile-empresas": "Companies",
          "mobile-perfil": "Profile",
        },
      };

      function cambiarIdiomaDashboard(lang) {
        localStorage.setItem("lang", lang);
        const elementos = traduccionesDashboard[lang];
        Object.keys(elementos).forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.textContent = elementos[id];
        });
        document.title = elementos["title-text"];
      }

      document.addEventListener("DOMContentLoaded", () => {
        const langGuardado = localStorage.getItem("lang") || "es";
        document.getElementById("language-select").value = langGuardado;
        cambiarIdiomaDashboard(langGuardado);
      });
    </script>
  </body>
</html>
